map $http_origin $cors_origin {
    default "";
    "~^https?://(eskani\.site|www\.eskani\.site)$" $http_origin;
    "~^http://localhost(:[0-9]+)?$" $http_origin;
    "~^http://srv1291240\.hstgr\.cloud(:[0-9]+)?$" $http_origin;
}

upstream backend {
    server backend:3000;
}

upstream frontend {
    server frontend:3001;
}

# Redirect HTTP to HTTPS (except for ACME challenge)
server {
    listen 80;
    server_name eskani.site www.eskani.site;

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        # return 301 https://$host$request_uri;
        # Temporary: Just show a message or proxy to frontend (via HTTP) to confirm it works
        # But frontend expects to be behind SSL? 
        # Let's just return a simple message.
        add_header Content-Type text/plain;
        return 200 'Waiting for SSL certificates...';
    }
}
